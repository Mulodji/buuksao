<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookRent - Book Catalog</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="./style.css">
    
</head>
<body>
    <header>
        <nav>
            <div class="logo"><img src="BooksAO_Logo_blue_background_no_text_edited.png" alt="Logo for the project - BooksAO" width="25%" height="auto" translate="no"><span class="centered-text" font-size="1.5em">Books.ao</span>
                <!--<a href="index.html">BookRent</a> -->
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="catalog.html">Catalog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="auth-buttons">
                <button id="signInBtn">Sign In</button>
                <button id="signUpBtn">Sign Up</button>
                <div class="user-info" style="display: none;">
                    <img id="userAvatar" src="https://via.placeholder.com/30" alt="User Avatar">
                    <span id="userName"></span>
                    <button id="signOutBtn">Sign Out</button>
                </div>
            </div>

            <div class="cart-widget" id="cartWidget">
                <h3>Cart</h3>
                <p>Total Books: <span id="cartTotalBooks">0</span></p>
                <p>Total Sum: $<span id="cartTotalSum">0.00</span></p>
                <button id="submitCart" disabled>Submit Rental</button>
            </div>

        </nav>
    </header>

    <main>
        <h1>Book Catalog</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search for books...">
            <button id="searchButton">Search</button>
        </div>
        <div class="book-catalog" id="bookCatalog">
            <!-- Books will be dynamically added here using JavaScript and Firestore -->
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About BookRent</h3>
                <p>BookRent is your go-to platform for renting books online. Discover, read, and return with ease.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="catalog.html">Catalog</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: info@bookrent.com</p>
                <p>Phone: (123) 456-7890</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2023 BookRent. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Initialize Firebase (unchanged)
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDSntHE9r9FarvHymAtRx7pUxQgMkYftC8",
  authDomain: "buuksao.firebaseapp.com",
  projectId: "buuksao",
  storageBucket: "buuksao.appspot.com",
  messagingSenderId: "1038398911771",
  appId: "1:1038398911771:web:8236adde6fc52f64fccfbe",
  measurementId: "G-M1LZ7W0WN7"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // DOM Elements (including new cart elements)
        const signInBtn = document.getElementById('signInBtn');
        const signUpBtn = document.getElementById('signUpBtn');
        const signOutBtn = document.getElementById('signOutBtn');
        const userInfo = document.querySelector('.user-info');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const bookCatalog = document.getElementById('bookCatalog');
        const cartTotalBooks = document.getElementById('cartTotalBooks');
        const cartTotalSum = document.getElementById('cartTotalSum');

        // Cart state
        let cart = [];

        // Auth state observer (unchanged)
        auth.onAuthStateChanged((user) => {
            if (user) {
                signInBtn.style.display = "none";
                signUpBtn.style.display = "none";
                userInfo.style.display = "flex";
                userAvatar.src = user.photoURL || "https://via.placeholder.com/30";
                userName.textContent = user.displayName || user.email;
            } else {
                signInBtn.style.display = "inline-block";
                signUpBtn.style.display = "inline-block";
                userInfo.style.display = "none";
            }
        });

        // Sign Out (unchanged)
        signOutBtn.onclick = () => {
            auth.signOut().then(() => {
                // Sign-out successful.
            }).catch((error) => {
                alert(error.message);
            });
        };

        // Function to display books (modified to include checkbox)
        function displayBooks(books) {
            bookCatalog.innerHTML = '';
            books.forEach((book) => {
                const bookCard = document.createElement('div');
                bookCard.classList.add('book-card');
                bookCard.innerHTML = `
                    <input type="checkbox" class="book-checkbox" data-book-id="${book.id}">
                    <img src="${book.coverImage}" alt="${book.title}">
                    <div class="book-info">
                        <h3>${book.title}</h3>
                        <p>By ${book.author}</p>
                    
                        <p>Rental Price: $${book.rentalPrice}/week</p>
                        <button class="rent-btn">Rent</button>
                    </div>
                `;
                bookCatalog.appendChild(bookCard);

                // Add event listener for the rent button (existing functionality)
                const rentBtn = bookCard.querySelector('.rent-btn');
                rentBtn.addEventListener('click', () => {
                    // Existing rent functionality goes here
                    console.log(`Renting book: ${book.title}`);
                });

                // Add event listener for the checkbox (new cart functionality)
                const checkbox = bookCard.querySelector('.book-checkbox');
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        addToCart(book);
                    } else {
                        removeFromCart(book);
                    }
                });
            });
        }

        // New cart functions
        function addToCart(book) {
            cart.push(book);
            updateCart();
        }

        function removeFromCart(book) {
            cart = cart.filter(item => item.id !== book.id);
            updateCart();
        }

        function updateCart() {
            const totalBooks = cart.length;
            const totalSum = cart.reduce((sum, book) => sum + book.rentalPrice, 0);
            
            cartTotalBooks.textContent = totalBooks;
            cartTotalSum.textContent = totalSum.toFixed(2);
        }

        // Add these new DOM elements
        const submitCartBtn = document.getElementById('submitCart');

        // Modify the updateCart function to enable/disable the submit button
        function updateCart() {
            const totalBooks = cart.length;
            const totalSum = cart.reduce((sum, book) => sum + book.rentalPrice, 0);
            
            cartTotalBooks.textContent = totalBooks;
            cartTotalSum.textContent = totalSum.toFixed(2);

            // Enable the submit button only if there are books in the cart
            submitCartBtn.disabled = totalBooks === 0;
        }

        // Add event listener for the submit button
        submitCartBtn.addEventListener('click', submitRental);

        // Function to submit the rental to Firestore
        function submitRental() {
            // Check if the user is signed in
            const user = auth.currentUser;
            if (!user) {
                alert('Please sign in to submit your rental.');
                return;
            }

            // Create a new rental document in Firestore
            db.collection('rentals').add({
                userId: user.uid,
                books: cart.map(book => ({
                    bookId: book.id,
                    title: book.title,
                    rentalPrice: book.rentalPrice
                })),
                totalPrice: cart.reduce((sum, book) => sum + book.rentalPrice, 0),
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then((docRef) => {
                console.log('Rental submitted with ID: ', docRef.id);
                alert('Your rental has been submitted successfully!');
                // Clear the cart
                cart = [];
                updateCart();
                // Uncheck all checkboxes
                document.querySelectorAll('.book-checkbox').forEach(checkbox => {
                    checkbox.checked = false;
                });
            })
            .catch((error) => {
                console.error('Error submitting rental: ', error);
                alert('An error occurred while submitting your rental. Please try again.');
            });
        }


        // Function to fetch all books (unchanged)
        function fetchAllBooks() {
            db.collection('books').get()
                .then((querySnapshot) => {
                    const books = [];
                    querySnapshot.forEach((doc) => {
                        books.push({ id: doc.id, ...doc.data() });
                    });
                    displayBooks(books);
                })
                .catch((error) => {
                    console.error("Error fetching books: ", error);
                });
        }

        // Function to search books (unchanged)
        function searchBooks(query) {
            query = query.toLowerCase().trim();
            db.collection('books').get()
                .then((querySnapshot) => {
                    const books = [];
                    querySnapshot.forEach((doc) => {
                        const book = doc.data();
                        if (
                            book.title.toLowerCase().includes(query) ||
                            book.author.toLowerCase().includes(query)
                        ) {
                            books.push(book);
                        }
                    });
                    displayBooks(books);
                })
                .catch((error) => {
                    console.error("Error searching books: ", error);
                });
        }
        // Event listener for search button (unchanged)
        searchButton.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
                searchBooks(query);
            } else {
                fetchAllBooks();
            }
        });

        // Event listener for search input (search as you type) (unchanged)
        searchInput.addEventListener('input', () => {
            const query = searchInput.value.trim();
            if (query) {
                searchBooks(query);
            } else {
                fetchAllBooks();
            }
        });

        // Load all books when the page loads (unchanged)
        window.addEventListener('load', fetchAllBooks);
    </script>
</body>
</html>